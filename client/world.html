<!DOCTYPE html>
<html>
<head>
<title>Tilemap Town</title>
<meta charset="UTF-8">
<link rel="canonical" href="https://tilemap.town/world">
<link rel="manifest" href="img/pwa/tilemaptown.webmanifest">
<!-- Resources -->
<link rel="stylesheet" type="text/css" href="css/world.css" />
<link rel="stylesheet" type="text/css" href="css/chat.css" />
<link rel="stylesheet" type="text/css" href="css/xbbcode.css" />
<script src="js/stretch.js"></script>
<script src="js/xbbcode.js"></script>
<script src="js/ui.js"></script>
<script src="js/input.js"></script>
<script src="js/draw_map.js"></script>
<script src="js/map.js"></script>
<script src="js/predefined.js"></script>
<script src="js/online.js"></script>
<script src="js/custom_code.js"></script>
<!-- Image resources -->
<img src="img/tileset/potluck.png"    style="display: none;" id="potluck">
<img src="img/tileset/extra.png"      style="display: none;" id="extras">
<img src="img/tileset/pulp.png"       style="display: none;" id="pulp">
<img src="img/tileset/easyrpg_v2.png" style="display: none;" id="easyrpg">
<img src="img/font/chicago.png"  style="display: none;" id="chicago">
<img src="img/font/tomthumb.png" style="display: none;" id="tomthumb">
<img src="img/font/tilemapsans.png" style="display: none;" id="tilemapsans">
</head>
<body onLoad="initWorld();" ondragstart="return false;" ondrop="return false;">
<noscript>The Tilemap Town web client requires JavaScript</noscript>
<template id="widget-window-template">
  <style>
    #container {
        position: absolute;
        background-color: white;

        left: 100px;
        top: 100px;

        min-width: 250px;

        border-radius: 4px;
        border: 1px solid black;
    }

    #contents {
        padding: 2px;

        max-height: 400px;
        overflow: scroll;
    }

    .draghandle {
        cursor: move;
        width: 100%;
        background-color: #333;
        color: #fff;
        text-align: center;

        line-height: 24px;
        height: 24px;

        user-select: none;

        border-radius: 4px 4px 0 0;
    }

    .widget-minimize {
        position: absolute;
        right: 1px;
        top: 1px;

        border: 1px solid black;
        border-radius: 4px;

        width: 16px;
        height: 16px;
        line-height: 16px;

        cursor: pointer;
    }

    .widget-minimize:hover {
        background-color: lightpink;
    }
  </style>
  <div id="container">
    <div class="draghandle" id="draghandle">
      <slot name="title"></slot>
      <div id="minimize" class="widget-minimize">-</div>
    </div>
    <div id="contents">
      <slot name="contents">Empty widget!</slot>
    </div>
  </div>
</template>

<template id="widget-contextmenu-template">
  <style>
    #container {
        background-color: white;

        border: 1px solid black;
    }

    #contents {
        padding: 2px;
    }
  </style>
  <div id="container">
    <slot id="menu" name="menu">Empty context menu!</slot>
  </div>
</template>

<!-- Wrapper everything is contained inside; takes up the entire screen -->
<div id="wrapper">

<!-- Menu bar -->
<ul class="topnav unselectable">
  <li><a id="navcustomize" href="#" onclick="viewCustomize();" title="Customize"><div style="width:16px; height:16px; background: url(img/tileset/potluck.png) -32px -400px;"></div></a></li>
  <li><a id="navmail"      href="#" onclick="viewMail();" title="Mail">Mail</a></li>
  <li><a id="navusers"     href="#" onclick="viewUsers();">Users</a></li>
  <li><a id="navmap"       href="#" >Map</a></li>
  <li><a id="navchatlog"   href="#" onclick="viewChatLog();" title="Chat Log">Chat Log</a></li>
  <li><a id="navbuild"     href="#" onclick="viewBuild();">Build</a></li>
  <li><a id="navinventory" href="#" onclick="viewInventory();" title="Inventory">Inventory</a></li>
  <li><a id="navfiles"     href="#" onclick="viewFiles();" title="Files">Files</a></li>
  <li><a id="navoptions"   href="#" onclick="viewOptions();">Options</a></li>
  <li><a id="navlogin"     href="#">Login</a></li>
  <li><a id="navhelp"      href="help.html" target="_blank" title="Help">Help</a></li>
</ul>

<div id="loginWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>Log into <a href="index.html">Tilemap Town</a></h1>
    <strong>If you don't have an account, leave the password blank.</strong><br>While connected, you can register with <span class="xbbcode-code">/register username password</span> if you wish.<br>
    <input type="text" id="loginuser" placeholder="Username"> Username<br>
    <input type="password" id="loginpass" placeholder="Password"> Password<br>
    <input type="text" id="loginserver" value="novasquirrel.com/townws/" placeholder="Server"> Server<br>
    <input type="button" value="Connect" onclick="loginButton();">
    </p>
    <p>
    If you're using a phone tablet, you want the <a href="touch_ui.html">touch UI client</a>.
    </p>
    <p id="passwordResetHint" style="display:none;">
    <span id="loginErrorText" style="font-weight: bold;"></span><br>
    If you need a password reset, you can <a href="https://novasquirrel.com/contact.html">contact Tilemap Town's developer</a>.
    </p>
  </div>
</div>

<div id="mapOptionsWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>Map</h1>

    <div id="map_window_online" style="display: none;">
    <table border="0">
    <tr>
    <td><label for="mapname" class="unselectable">Map name</label></td>
    <td><input type="text" id="mapname"/></td>
    </tr>
    <tr>
    <td><label for="mapdesc" class="unselectable">Description</label></td>
    <td><textarea id="mapdesc"></textarea></td>
    </tr>
    <tr>
    <td><label for="mapowner" class="unselectable">Map owner</label></td>
    <td><input type="text" id="mapowner" disabled/></td>
    </tr>
    <tr>
    <td><label for="mapid" class="unselectable">Map ID</label></td>
    <td><input type="text" id="mapid" disabled/></td>
    </tr>
    </table>

    <p>
	<button onclick="sendChatCommand('mapspawn')">Set start position here</button>
	<button onclick="runLocalCommand('/exportmap')">Export map</button>
    </p>

    <p>
    <h2>Permissions</h2>
    <table border="0">
    <tr><td>Privacy</td><td><select id="mapprivacy">
      <option value="public">Public</option>
      <option value="unlisted">Unlisted</option>
      <option value="private">Private</option>
      <option value="?">Keep the same</option>
    </select></td></tr>
	</table>

	<p>
	Anyone can:
	<label class="unselectable">Build: <input type="checkbox" id="permission_build"></label>
	| <label class="unselectable">Bring objects: <input type="checkbox" id="permission_object_entry"></label>
	| <label class="unselectable">Leave objects here: <input type="checkbox" id="permission_persistent_object"></label>
	| <label class="unselectable">Set topics: <input type="checkbox" id="permission_topic"></label>
	</p>

    <p>
    <button onclick="applyMapWindowChanges()">Apply changes</button>
    <button onclick="cancelMapWindowChanges()">Cancel</button>
    </p>
    </div>

	<div id="map_window_offline">
	You're offline! You can still make maps by yourself and save them to your device.

	<p>
	<input type="number" value="100" min="10" max="200" id="localMapWidth" size="4" />&times;<input type="number" value="100" min="10" max="200" id="localMapHeight" size="4" /> <button onclick="resizeLocalMap()">Resize map</button> | <button onclick="clearLocalMap()">Clear map</button>
	</p>

	<p>
	<strong>Locally stored maps:</strong><br>
	<input placeholder="Map name" id="localMapName"> <button onclick="saveLocalMap()">Save</button><br>
	<select id="localMapList"></select> <button onclick="loadLocalMap()">Load</button> | <button onclick="deleteLocalMap()">Delete</button>
	</p>

	<p>
	<strong>Import/Export:</strong><br>
	<input type="file" id="importmapfile" /><br><button onclick="importLocalMap()">Import map</button><br><br>
	<button onclick="runLocalCommand('/exportmap ' + document.getElementById('localMapName').value)">Export map</button>
	</p>

	</div>

  </div>
</div>

<div id="newItemWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>New item</h1>

    <p>
    <label for="newtilename" class="unselectable">Item name</label><br>
    <input type="text" id="newtilename" value="new item"/>
    </p>

    <input type="button" value="Generic" onclick="newItemCreate('generic');" />
    <input type="button" value="Map tile" onclick="newItemCreate('map_tile');" />
    <input type="button" value="Text" onclick="newItemCreate('text');" />
    <input type="button" value="Tile sheet" onclick="newItemCreate('image');" />
    <!--<input type="button" value="Tileset" onclick="newItemCreate('tileset');" />-->
    <input type="button" value="Folder" onclick="newItemCreate('folder');" />
    <input type="button" value="Gadget" onclick="newItemCreate('gadget');" />
    </p>
    <p>
    <label class="unselectable"><input type="checkbox" id="createtempobject">Create as temporary entity</label>
    </p>
    <p>
	<ul>
	<li>Map tiles are templates for tiles to place down on the map, like how the build menu works.</li>
	<li>Generic items are more like standard video game items, and you can drop them onto maps to have them act as props!</li>
	<li>Tile sheet items add additional images you can pick when editing tiles. If you delete the item, tiles referencing it will lose their appearance.</li>
	</ul>
    </p>
    <p>
    <input type="button" value="Cancel" onclick="newItemCancel();" />
    </p>
  </div>
</div>

<div id="newFileWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>New file</h1>

    <p>
    <input type="file" id="newfilefile" accept="image/png,.mod,.s3m,.xm,.it,.mptm" />
    </p>

    <p>
    <label for="newfilename" class="unselectable">File name</label><br>
    <input type="text" id="newfilename" value="Image"/>
    </p>

    <p>
    <label for="newfiledesc" class="unselectable">File description</label><br>
    <textarea id="newfiledesc"></textarea>
    </p>

	How would you like to use this file?<br>
	<table>
	<tr><td>Map tile graphics:</td><td><input type="button" value="Upload and create tile sheet item" onclick="createNewFile(false, true);" /></td></tr>
	<tr><td>Avatar graphics:</td><td><input type="button" value="Upload and set appearance" onclick="createNewFile(true, false);" /></td></tr>
	</table>
    Otherwise you can just <input type="button" value="Upload file" onclick="createNewFile(false, false);" /><br>
    <br>
    
    </p>
    <p>
    <input type="button" value="Cancel" onclick="newFileCancel();" />
    </p>
  </div>
</div>

<div id="newFolderWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>New folder</h1>

    <p>
    <label for="newfoldername" class="unselectable">Folder name</label><br>
    <input type="text" id="newfoldername" value="new item"/>
    </p>

    <p>
    <label for="newfolderdesc" class="unselectable">Folder description</label><br>
    <textarea id="newfolderdesc"></textarea>
    </p>

    <input type="button" value="Create folder" onclick="createNewFolder();" />
    </p>
    <p>
    <input type="button" value="Cancel" onclick="newFolderCancel();" />
    </p>
  </div>
</div>

<div id="editFileWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>Edit file</h1>

    <p>
    <input type="file" id="editfilefile" accept="image/png" />
    </p>

    <p>
    <label for="editfilename" class="unselectable">File name</label><br>
    <input type="text" id="editfilename" value="Image"/>
    </p>

    <p>
    <label for="editfiledesc" class="unselectable">File description</label><br>
    <textarea id="editfiledesc"></textarea>
    </p>

	
    <input type="button" value="Only edit name and description" onclick="doEditFile(false, false, false);" />
	<p>
    <input type="button" value="Reupload file" onclick="doEditFile(true, false, false);" /><br>
    <input type="button" value="Reupload file and set appearance" onclick="doEditFile(true, true, false);" /><br>
    <input type="button" value="Reupload file but keep URL" onclick="doEditFile(true, false, true);" />
	</p>
    </p>
    <p>
    <input type="button" value="Cancel" onclick="editFileCancel();" />
    </p>
  </div>
</div>

<div id="editFolderWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>Edit folder</h1>

    <p>
    <label for="editfoldername" class="unselectable">Folder name</label><br>
    <input type="text" id="editfoldername" value="new item"/>
    </p>

    <p>
    <label for="editfolderdesc" class="unselectable">Folder description</label><br>
    <textarea id="editfolderdesc"></textarea>
    </p>

    <input type="button" value="Edit folder" onclick="doEditFolder();" />
    </p>
    <p>
    <input type="button" value="Cancel" onclick="editFolderCancel();" />
    </p>
  </div>
</div>

<div id="itemEditTilePickerWindow" class="modal">
  <div class="modal-content">
    <span class="modalclose">&times;</span>
    <p>
    <h1>Pick a tile:</h1>
    <div id="itemEditTilePickerWindowDiv">
    <img id="itemEditTilePickerWindowImg">
    </div>
    </p>
  </div>
</div>

<widget-window id="selectionInfo" style="display: none;">
  <span slot="title">Selection Info</span>
  <div slot="contents">
    <div id="panel"></div>
    <div>
      <span id="deleteTurfObj">
      <label><input type="checkbox" id="turfselect" checked="true">Tiles</label>
      <label><input type="checkbox" id="objselect" checked="true">Objects</label>
      <input type="button" value="&#x1F4A3;Delete" onclick="selectionDelete();">
      </span>
      <span id="getTileObjSpan">
        <input type="button" value="&#x26F0;&#xFE0F;Copy Tile"    onclick="copyTurfFromSelection();">
        <input type="button" value="&#x1F4CB;Copy Object"  onclick="copyObjFromSelection();">
      </span>
    </div>
    <span id="selectedentities_span">
      Selected Entities:
      <ul id="selectedentitiesul" class="itemsul unselectable">
      </ul>
    </span>
    <span id="selectedfloor_span">
      Selected Floor:
      <ul id="selectedfloorul" class="itemsul unselectable">
      </ul>
    </span>
    <span id="selectedobjects_span">
      Selected Objects:
      <ul id="selectedobjectsul" class="itemsul unselectable">
      </ul>
    </span>
  </div>
</widget-window>

<widget-window id="users" style="display: none;">
  <span slot="title">Users</span>
  <div slot="contents">
    <label class="unselectable"><input type="checkbox" id="userlist_all_entities" onchange="updateUsersUL()">All entities</label>
    <span id="userlist_span">
      <hr><strong>Users</strong><br>
      <ul id="usersul" class="itemsul unselectable"></ul>
	</span>

    <span id="chatlisteners_span">
      <hr><strong>Chat listeners</strong><br>
      <ul id="chatlistenerul" class="itemsul unselectable"></ul>
    </span>

    <span id="messageforward_span">
      <hr><strong>Other listeners</strong><br>
      <ul id="messageforwardul" class="itemsul unselectable"></ul>
    </span>

    <span id="otherentity_span">
      <hr><strong>Other entities</strong><br>
      <ul id="otherentityul" class="itemsul unselectable"></ul>
    </span>
  </div>
</widget-window>

<widget-window id="inventory" style="display: none;">
  <span slot="title">Inventory</span>
  <div slot="contents" id="inventory-contents">
    <ul id="inventoryul" class="itemsul unselectable">
    </ul>
  </div>
</widget-window>

<widget-window id="build" style="display: none;">
  <span slot="title">Build</span>
  <div slot="contents" id="build-contents">

	<table style="margin: auto;" id="buildToolSelectTable">
	<tr>
	<td><label class="unselectable"><input type="radio" id="buildToolSelect" name="buildTool" onchange="changeBuildTool();" checked>&#x1F50D;Select</label></td>
	<td><label class="unselectable"><input type="radio" id="buildToolDraw"   name="buildTool" onchange="changeBuildTool();">&#x1F58C;&#xFE0F;Draw</label></td>
	</tr>
	</table>

    <label class="unselectable">Category: <select id="buildToolCategory" onchange="changedBuildToolCategory();">
      <option value="!global">Global tiles</option>
      <option value="!inventory">My inventory</option>
    </select></label>

    <br>
    <canvas class="unselectable" id="inventoryCanvas" width="320" height="320" imageSmoothingEnabled="false"></canvas>
    <br>
    <button onclick="sendChatCommand('undodel');">Undo delete</button>
    <button onclick="undoDrawStroke();">Undo draw</button>
    <label class="unselectable"><input type="checkbox" id="zoom-build-menu" onchange="buildMenuZoom()">Zoom</label>
  </div>
</widget-window>

<widget-window id="options" style="display: none;">
  <span slot="title">Options</span>
  <div slot="contents">
    <label class="unselectable"><input type="checkbox" id="alwayscenter" checked="true">Always center camera</label><br>
    <label class="unselectable"><input type="checkbox" id="audiochatnotify" checked>Notify when people talk</label><br>
    <label class="unselectable"><input type="checkbox" id="audiomiscnotify">Notify on other messages</label><br>
    <label class="unselectable"><input type="checkbox" id="audiomapmusic">Play map background music</label><br>
    <label class="unselectable"><input type="checkbox" id="option-fly">Walk through walls</label><br>
    <label class="unselectable"><input type="checkbox" id="option-entity-animation" checked>Entity animation</label><br>
    <label class="unselectable"><input type="checkbox" id="option-tile-animation" checked>Tile animation</label><br>
	<details>
		<summary class="unselectable">More options</summary>
		<label class="unselectable"><input type="checkbox" id="lock-zoom-level">Lock zoom level</label><br>
		<label class="unselectable"><input type="checkbox" id="warn-invalid-bbcode" checked>Warn about invalid BBCode</label><br>
		<label class="unselectable"><input type="checkbox" id="chat-timestamp" checked>Show chat timestamps</label><br>
		<label class="unselectable"><input type="checkbox" id="focus-map-after-chat">Refocus map after sending chat</label><br>
	</details>

    <ul>
      <li>
        Zoom level:

        <input id="zoomout" type="button" onclick="zoomOut();" value="-">
        <span id="zoomlevel">3.00x</span>
        <input id="zoomin" type="button" onclick="zoomIn();" value="+">
      </li>
    </ul>

    <p>
    <label class="unselectable">Mark self as idle after <input type="number" id="minutes-until-idle" size="4" value="60"> minutes</label><br>
    <label class="unselectable">Disconnect after <input type="number" id="minutes-until-disconnect" size="4" value="720"> minutes</label><br>
    Disable by entering 0
    </p>

    <input type="button" onclick="applyOptions(); viewOptions();" value="OK">
    <input type="button" onclick="applyOptions();" value="Apply changes">
    <input type="button" onclick="viewOptions();" value="Close options">
  </div>
</widget-window>

<widget-window id="character" style="display: none;">
  <span slot="title">Character Settings</span>
  <div slot="contents">
  <strong>Name:</strong><br>
  <input type="text" placeholder="New name" id="newnick">
  <input type="button" value="Rename" onclick="sendChatCommand('nick '+document.getElementById('newnick').value);"><br>

  <strong>Status:</strong><br>
  <select id="quickstatus">
    <option value="">&#x2728;</option>
    <option value="away">&#x1F343;Away</option>
    <option value="busy">&#x1F697;Busy</option>
    <option value="rp">&#x1F3AD;Roleplaying</option>
    <option value="lfrp">&#x1F3AD;Looking to roleplay</option>
    <option value="chat">&#x1F4AC;Chat with me!</option>
    <option value="ooc">&#x1F9CD;Out of character</option>
    <option value="dnd">&#x26D4;Do not disturb</option>
  </select> <input id="quickstatustext" type="text" placeholder="Extra context" size="15" maxlength="50"> <button onclick="setUserStatusButton();">Set status</button>
  <p><button onclick="SendCmd('EXT', { 'get_user_profile': {'username': PlayerYou} });">Set my user profile</button></p>

  <hr>
  <p>
    <strong>Sample avatars:</strong><br>
    <input type="button" value="Bunny" onclick="sendChatCommand('userpic bunny');">
    <input type="button" value="Cat" onclick="sendChatCommand('userpic cat');">
    <input type="button" value="Hamster" onclick="sendChatCommand('userpic hamster');">
    <input type="button" value="Fire" onclick="sendChatCommand('userpic fire');">
    <input type="button" value="Snail" onclick="sendChatCommand('userpic snail');">
    <input type="button" value="Turtle" onclick="sendChatCommand('userpic turtle');">
    <input type="button" value="More!" onclick="morePresetAvatars();">
  </p>

  <p>
    <strong>Custom avatar:</strong><br>
    Paste a link to a PNG here to use a custom avatar.<br>
    Registered users can <a href="#" onclick="viewFiles();">upload images</a> to the server.<br>Otherwise you may use <a href="https://filegarden.com/" target="_blank">File Garden</a>, <a href="https://imgbb.com/" target="_blank">ImgBB</a> or <a href="https://postimages.org/" target="_blank">Postimages</a>.<br>More image hosts can be added on request.<br>
    <input type="text" placeholder="https://example.com/whatever.png" size="40" id="newcustompic">
    <input type="button" value="Custom pic" onclick="sendChatCommand('userpic '+document.getElementById('newcustompic').value);">
  </p>

<!--
        <input id="iconPicker" type="file" onchange="previewIcon();"><br>
        <img id="iconPreview" src="" width="32" height="32" alt="Image preview"><br>
        <input type="button" value="Use"><br>
-->
        </div>
</widget-window>

<widget-window id="filelist" style="display: none;">
  <span slot="title">File uploads</span>
  <div slot="contents" id="filelist-contents">
    <span id="filelist-status"></span>
    <ul id="filesul" class="itemsul unselectable">
    </ul>
  </div>
</widget-window>

<widget-window id="tileset" style="display: none;">
  <span id="tileset-title" slot="title">Tileset</span>
  <div slot="contents">
    <canvas class="unselectable" id="tilesetCanvas'+Item.id+'" width="256" height="16" oncontextmenu="return false;" imageSmoothingEnabled="false"></canvas>
    <br>
    <button>Add tile</button>
  </div>
</widget-window>

<widget-window id="premadeavatarlist" style="display: none;">
  <span slot="title">Sample avatars</span>
  <div slot="contents" id="premadeavatarlist-contents">
	Click an avatar to switch to it:<br>
    <ul id="premadeavatarul" class="itemsul unselectable">
    </ul>
  </div>
</widget-window>

<widget-window id="mail" style="display: none;">
  <span slot="title">Mail</span>
  <div slot="contents">
    <button class="spaced_buttons" onclick="viewCompose();">Compose</button>
    <button class="spaced_buttons" onclick="mailSelectToggle();">Toggle</button>
    <button class="spaced_buttons" onclick="mailSelectDelete();">Delete</button>
    <ul id="mailul" class="unselectable">
    </ul>
  </div>
</widget-window>

<widget-window id="compose" style="display: none;">
  <span slot="title">Compose</span>
  <div slot="contents">
    <table border="0">
      <tr><td><input class="spaced_buttons" type="submit" onclick="sendMail();" value="Send!" /></td><td><button class="spaced_buttons" onclick="previewMail();">Preview</button></td></tr>
      <tr><td>To</td><td><input type="text" id="mailsendto" /></td></tr>
      <tr><td>Subject</td><td><input type="text" id="mailsendsubject" /></td></tr>
    </table>
    <textarea id="mailsendtext" cols="30" rows="10"></textarea>
  </div>
</widget-window>

<widget-window id="mail-view" style="display: none;">
  <span slot="title" id="mail-view-title">Mail View</span>
  <div slot="contents" id="mail-view-contents">
  </div>
</widget-window>

<widget-window id="mail-preview" style="display: none;">
  <span slot="title" id="mail-preview-title">Mail Preview</span>
  <div slot="contents" id="mail-preview-contents">
  </div>
</widget-window>

<widget-window id="moveItem" style="display: none;">
  <span slot="title" id="moveItemTitle">Move Item</span>
  <div slot="contents" id="inventory-contents">
    Moving <span id="moveItemNoun">item</span>:
    <ul id="movesourceul" class="itemsul unselectable">
    </ul>

    Please select a folder to move it into!
    <ul id="movetargetul" class="itemsul unselectable">
    </ul>
  </div>
</widget-window>

<widget-window id="editItemWindow" style="display: none;">
  <span slot="title">Edit Item</span>
  <div slot="contents">
    <div id="edittileimage">
    Image URL: <input type="text" id="edittileurl" /><br>
    <p>This should be an image uploaded to this server, or on<br><a href="https://filegarden.com/" target="_blank">File Garden</a>, <a href="https://imgbb.com/" target="_blank">ImgBB</a> or <a href="https://postimages.org/" target="_blank">Postimages</a>.<br>More image hosts can be added on request.</p>
	<p>You can select this item in the tile editing window<br>to use it for tile graphics.</p>
    </div>

	<div id="edittilegadget">
		<strong>Gadget</strong><br>
		Type:
		<label class="unselectable"><input type="radio" id="gadgetTypeScript" name="gadgetType" onchange="changeGadgetType()" checked>Scripted</label>
		<label class="unselectable"><input type="radio" id="gadgetTypePreset" name="gadgetType" onchange="changeGadgetType()">Built-in</label>
		<label class="unselectable"><input type="radio" id="gadgetTypeRaw"    name="gadgetType" onchange="changeGadgetType()">Raw</label>
		<br>
		<div id="edittilegadget_script">
			Run script: <select id="edittilegadget_script_run">
			  <option value="auto_script">when gadget is loaded</option>
			  <option value="map_script">when gadget is on a map</option>
			  <option value="use_script">when gadget is "used"</option>
			</select> <label class="unselectable"><input type="checkbox" id="edittilegadget_script_disable">Disable script</label><br>
			<textarea id="edittilegadget_script_text" cols="60" rows="15" placeholder="tt.owner_say(&quot;Hello World!&quot;)"></textarea><br>
			<label class="unselectable" for="edittilegadget_script_usable"><input type="checkbox" id="edittilegadget_script_usable">Gadget can be "used"</label><br>
			Text item to get source from: <input type="text" id="edittilegadget_script_item" placeholder="Item entity ID">
		</div>
		<div id="edittilegadget_preset">
			Preset: <select id="edittilegadget_preset_choice" onchange="changeGadgetPreset()">
			  <option value="rc_car">Remote control car</option>
			  <option value="accept_requests">Accept requests</option>
			  <option value="random_say">Say random message</option>
			  <option value="random_tell">Random private message</option>
			  <option value="dice">Dice</option>
			  <option value="bot_message_button">Bot message button</option>
			  <option value="pushable">Pushable</option>
			</select>
			<div id="edittilegadget_preset_rc_car">
				<label class="unselectable" for="edittilegadget_preset_rc_car_owner_only"><input type="checkbox" id="edittilegadget_preset_rc_car_owner_only">Only the owner can use this</label><br>
				<label class="unselectable" for="edittilegadget_preset_rc_car_fly"><input type="checkbox" id="edittilegadget_preset_rc_car_fly">Car can move through walls</label><br>
				<label class="unselectable" for="edittilegadget_preset_rc_car_give_rides"><input type="checkbox" id="edittilegadget_preset_rc_car_give_rides">Car accepts carryme requests</label>
			</div>
			<div id="edittilegadget_preset_accept_requests">
				<label class="unselectable" for="edittilegadget_preset_accept_requests_owner_only"><input type="checkbox" id="edittilegadget_preset_accept_requests_owner_only">Only accept requests from the owner</label><br>
				Types to accept: <input id="edittilegadget_preset_accept_requests_types" placeholder="carry,carryme,followme,...">
			</div>
			<div id="edittilegadget_preset_random_message">
				<textarea id="edittilegadget_preset_random_message_text" cols="60" rows="8" placeholder="One message per line"></textarea>
			</div>
			<div id="edittilegadget_preset_dice">
				<table border="0">
				<tr><td>Dice</td><td><input type="number" value="2" id="edittilegadget_preset_dice_dice" placeholder="2" size="3" /></td></tr>
				<tr><td>Sides</td><td><input type="number" value="6" id="edittilegadget_preset_dice_sides" placeholder="6" size="3" /></td></tr>
				</table>
			</div>
			<div id="edittilegadget_preset_bot_message_button">
				<table border="0">
				<tr><td>Send to</td><td><input value="" id="edittilegadget_preset_bot_message_button_id" placeholder="Entity ID" /></td></tr>
				<tr><td>Text</td><td><input value="" id="edittilegadget_preset_bot_message_button_text" placeholder="Text to send" /></td></tr>
				</table>
			</div>
			<div id="edittilegadget_preset_pushable">
				<label class="unselectable" for="edittilegadget_preset_pushable_fly"><input type="checkbox" id="edittilegadget_preset_pushable_fly">Gadget can move through walls</label>
			</div>
		</div>
		<div id="edittilegadget_raw">
			<textarea id="edittilegadget_raw_textarea" cols="60" rows="8" placeholder="Raw JSON for the gadget"></textarea>
		</div>
		<br>
		<input type="button" value="Apply changes" onclick="editItemApply();">
		<input type="button" value="Cancel" onclick="editItemCancel();">
		<hr>
	</div>

    <div id="edittiletext">
    <textarea id="edittiletextarea" cols="60" rows="15"></textarea>
    </div>

    <div id="edittileobject">
    <p>
    <strong>Item picture</strong><br>
	<span id="itemImageTypePicker">Type:
	<label class="unselectable"><input type="radio" id="itemImageIsSheet" name="itemImageType" onchange="changeItemImageType()" checked>Normal</label>
	<label class="unselectable"><input type="radio" id="itemImageIsURL" name="itemImageType" onchange="changeItemImageType()">URL</label>
	</span>

	<div id="tileImageSheetOptions">
    Tile sheet: <select id="edittilesheet" onchange="editItemUpdatePic();">
      <option value="0">Potluck</option>
      <option value="-1">Extras</option>
      <option value="-2">Pulp</option>
      <option value="-3">EasyRPG</option>
      <option value="custom">Custom</option>
    </select><br>

	<img src="img/transparent.png" width="16" height="16" id="edittilepic" style="background: url(img/potluck.png) 0px 0px;">
    <input type="number" value="0" id="edittilex" oninput="editItemUpdatePic();" size="4" />
    <input type="number" value="0" id="edittiley" oninput="editItemUpdatePic();" size="4" />
	<button onclick="itemEditZoom();">Zoom</button> <input type="button" value="Apply changes" onclick="editItemApply();"><br>
    <p>
    <div style="overflow:scroll; width:528px; height:256px;" id="edittilesheetcontainer">
    <img src="" id="edittilesheetselect">
    </div>
    </p>
	</div>
	<div id="tileImageURLOptions">URL: <input id="edittileimageurl" type="text" placeholder="Image URL"></div>
    </p>

	<p><details id="edittileautotileoptions">
	<summary class="unselectable">Autotiling</summary>
	<table border="0">
	<tr><td>Type</td><td><select id="edittileautotile">
		<option value="0">None</option>
		<option value="1">9 slice</option>
		<option value="2">4 directions - Middle</option>
		<option value="3">4 directions - Single</option>
		<option value="4">RPG - Middle</option>
		<option value="5">RPG - Single</option>
		<option value="6">Horizontal - Middle 3</option>
		<option value="7">Horizontal - Middle 4</option>
		<option value="8">Horizontal - Single 4</option>
		<option value="9">Vertical - Middle 3</option>
		<option value="10">Vertical - Middle 4</option>
		<option value="11">Vertical - Single 4</option>
		<option value="12">Quarter 8-way - Middle (8)</option>
		<option value="13">Quarter 8-way - Single (8)</option>
		<option value="14">Quarter 8-way - Middle (16)</option>
		<option value="15">Quarter 8-way - Single (16)</option>
	</select></td></tr>
	<tr><td>Class</td><td><input type="text" id="edittileautotileclass" placeholder="Autotile class" /></td></tr>
	<tr><td>Class (edge)</td><td><input type="text" id="edittileautotileclassedge" placeholder="Autotile class (edge)" /></td></tr>
	</table>
	This tile will connect to others if the classes match,<br>or (if a class isn't provided) the names match.<br>A tile will connect to another tile's "edge" class in one direction.
	</details></p>

	<p><details id="edittileanimationoptions">
	<summary class="unselectable">Animation</summary>
	<table border="0">
	<tr><td>Frames</td><td><input type="number" value="0" size="4" id="edittileanimationframes" /></td></tr>
	<tr><td>Frame duration</td><td><input type="number" value="0"  size="4" id="edittileanimationspeed" /> (units of 0.1 seconds)</td></tr>
	<tr><td>Start offset</td><td><input type="number" value="0" size="4" id="edittileanimationoffset" /> (units of 0.1 seconds)</td></tr>
	<tr><td>Direction</td><td>
    <select id="edittileanimationmode">
        <option value="0">Forwards</option>
        <option value="1">Backwards</option>
        <option value="2">Ping-pong</option>
        <option value="3">Ping-pong reverse</option>
    </select></td></tr>
	</table>
	</details></p>

	<strong>Item properties</strong>
    <table border="0">
    <tr>
    <td><label for="edittilename" class="unselectable">Name</label></td>
    <td><input type="text" id="edittilename"/></td>
    </tr>
    <tr>
    <td><label for="edittiledesc" class="unselectable" id="description_or_message">Description</label></td>
    <td><textarea id="edittiledesc"></textarea></td>
    </tr>
    </table>

    <div id="edittilemaptile">
    <p>
    Item type<br>
    <select id="edittiletype">
      <option value="">Normal</option>
      <option value="sign">Sign</option>
<!--      <option value="door">Door</option>
      <option value="ice">Ice</option>
      <option value="escalator">Escalator</option>
      <option value="water">Water</option> -->
    </select>
    </p>

    <p>
    <label class="unselectable"><input type="checkbox" id="edittiledensity">Item is a wall</label><br>
    <label class="unselectable"><input type="checkbox" id="edittileisobject">Item is a floor tile</label><br>
    <label class="unselectable"><input type="checkbox" id="edittileover">Display item above players</label>
    </p>
    </div>
    </div>

	<div id="itemproperties_notmaptile">
	<strong>Item properties</strong>
    <table border="0">
    <tr>
    <td><label for="edittilename_notmaptile" class="unselectable">Name</label></td>
    <td><input type="text" id="edittilename_notmaptile"/></td>
    </tr>
    <tr>
    <td><label for="edittiledesc_notmaptile" class="unselectable">Description</label></td>
    <td><textarea id="edittiledesc_notmaptile"></textarea></td>
    </tr>
    </table>
	</div>

    <br>
    <input type="button" value="Apply changes" onclick="editItemApply();">
    <input type="button" value="Cancel" onclick="editItemCancel();">
  </div>
</widget-window>

<widget-window id="viewUserProfileWindow" style="display: none;">
	<span slot="title">User profile</span>
	<div slot="contents">
		<strong id="userProfileName"></strong> (<span id="userProfileUsername"></span>) <span id="userProfilePronounsDot">&#8226;</span> <span id="userProfilePronouns"></span><br>
		<span id="userProfileBirthdaySpan">&#x1F382; <span id="userProfileBirthday"></span><br></span>
		Last updated <span id="userProfileUpdatedAt"></span>
		<button id="userProfileEditButton" onclick="userProfileEdit()">Edit</button>
		<hr>
		<button onclick="profileTabAbout()">About</button><button id="profileTabPictureButton" onclick="profileTabPicture()">Picture</button><button id="profileTabInterestsButton" onclick="profileTabInterests()">Interests</button><button id="profileTabContactButton" onclick="profileTabContact()">Contact</button><button id="profileTabHomeButton"onclick="profileTabHome()">Home</button>
		<div id="userProfileAbout">
			<p>&#x1F407; <strong id="userProfileCharacterName"></strong> <span id="userProfileCharacterPronounsDot">&#8226;</span> <span id="userProfileCharacterPronouns"></span><br><span id="userProfileCharacterDescription" class="column-of-text-in-window"></span><p>
			<hr>
			<p>
				<table border="1" id="userProfileExtraFields">
				</table>
			</p>
			<p id="userProfileAboutText" class="column-of-text-in-window"></p>
		</div>
		<div id="userProfilePicture" style="display: none;">
			<p>
				<img id="userProfilePicturePicture" style="max-width: 512px; max-height: 512px;">
			</p>
		</div>
		<div id="userProfileInterests" style="display: none;">
			<p id="userProfileInterestsInterestsParagraph">
				<strong>Interests</strong><br><span id="userProfileInterestsInterests" class="column-of-text-in-window"></span>
			</p>
			<p id="userProfileInterestsLookingForParagraph">
				<strong>Looking for</strong><br><span id="userProfileInterestsLookingFor" class="column-of-text-in-window"></span>
			</p>
		</div>
		<div id="userProfileContact" style="display: none;">
			<p id="userProfileContactEmailParagraph">
				<strong>Email</strong><br><span id="userProfileContactEmail" class="column-of-text-in-window"></span>
			</p>
			<p id="userProfileContactWebsiteParagraph">
				<strong>Website</strong><br><span id="userProfileContactWebsite" class="column-of-text-in-window"></span>
			</p>
			<p>
				<table border="1" id="userProfileContactTable">
				</table>
			</p>
		</div>
		<div id="userProfileHome" style="display: none;">
			<p>
				<strong>Home</strong><br><span id="userProfileHomeName"></span>
			</p>
			<p>
				<button onclick="userProfileGoToHome()" id="userProfileHomeButton">Visit</button>
			</p>
		</div>
	</div>
</widget-window>

<widget-window id="viewMiniUserProfileWindow" style="display: none;">
	<span slot="title">User profile</span>
	<div slot="contents">
		<p>This user doesn't have a user profile yet</p>
		<p>&#x1F407; <strong id="userMiniProfileCharacterName"></strong><br><span id="userMiniProfileCharacterDescription" class="column-of-text-in-window"></span><p>
	</div>
</widget-window>

<widget-window id="editUserProfileWindow" style="display: none;">
	<span slot="title">Edit user profile</span>
	<div slot="contents">
		<button onclick="editUserProfileUpdate()">Update</button>
		<button onclick="editUserProfileDeleteProfile()">Delete profile</button>
		<hr>
		<p>
			<table border="1">
			<tr><th>Character name</th><td><input id="editUserProfileCharacterName"></td></tr>
			<tr><th>Character pronouns</th><td><input id="editUserProfileCharacterPronouns"></td></tr>
			<tr><th>Character description</th><td><textarea id="editUserProfileCharacterDesc"></textarea></td></tr>
			</table>
		</p>
		<hr>
		<p>
			<table border="1">
				<tr><th>Name</th><td><input id="editUserProfileName"></td></tr>
				<tr><th>Pronouns</th><td><input id="editUserProfilePronouns"></td></tr>
				<tr><th>Picture URL</th><td><input id="editUserProfilePictureUrl"></td></tr>
				<tr><th>Birthday<br>(YYYY-MM-DD format)</th><td><input id="editUserProfileBirthday"></td></tr>
				<tr><th>Email</th><td><input id="editUserProfileEmail"></td></tr>
				<tr><th>Website</th><td><input id="editUserProfileWebsite"></td></tr>
				<tr><th>Interests<br>(comma separated)</th><td><input id="editUserProfileInterests"></td></tr>
				<tr><th>Looking for</th><td><textarea id="editUserProfileLookingFor"></textarea></td></tr>
				<tr><th>Hide birthday<br>(only show age)</th><td><input type="checkbox" id="editUserProfileHideBirthday"></td></tr>
				<tr><th>Hide email<br>(only visible to admin)</th><td><input type="checkbox" id="editUserProfileHideEmail"></td></tr>
			</table>
		</p>
		<hr>
		<p><strong>About me</strong><br><textarea style="width: 100%;" rows="5" id="editUserProfileAbout"></textarea></p>
		<hr>
		<p><strong>Home</strong> <button onclick="editUserProfileSetHomeHere()">Set home to here</button><br>
			<table border="1">
				<tr><th>Home map</th><td><input id="editUserProfileHomeMap"></td></tr>
				<tr><th>Home X</th><td><input id="editUserProfileHomeX"></td></tr>
				<tr><th>Home Y</th><td><input id="editUserProfileHomeY"></td></tr>
			</table>
		<hr>
		<p>
			<strong>Extra "about" fields</strong>
			<table border="1">
				<tr><th><input id="editUserProfileExtraAboutKey0"></th><td><input id="editUserProfileExtraAboutValue0"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey1"></th><td><input id="editUserProfileExtraAboutValue1"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey2"></th><td><input id="editUserProfileExtraAboutValue2"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey3"></th><td><input id="editUserProfileExtraAboutValue3"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey4"></th><td><input id="editUserProfileExtraAboutValue4"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey5"></th><td><input id="editUserProfileExtraAboutValue5"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey6"></th><td><input id="editUserProfileExtraAboutValue6"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey7"></th><td><input id="editUserProfileExtraAboutValue7"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey8"></th><td><input id="editUserProfileExtraAboutValue8"></td></tr>
				<tr><th><input id="editUserProfileExtraAboutKey9"></th><td><input id="editUserProfileExtraAboutValue9"></td></tr>
			</table>
		</p>
		<hr>
		<p>
			<strong>Extra "contact" fields</strong>
			<table border="1">
				<tr><th><input id="editUserProfileExtraContactKey0"></th><td><input id="editUserProfileExtraContactValue0"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey1"></th><td><input id="editUserProfileExtraContactValue1"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey2"></th><td><input id="editUserProfileExtraContactValue2"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey3"></th><td><input id="editUserProfileExtraContactValue3"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey4"></th><td><input id="editUserProfileExtraContactValue4"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey5"></th><td><input id="editUserProfileExtraContactValue5"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey6"></th><td><input id="editUserProfileExtraContactValue6"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey7"></th><td><input id="editUserProfileExtraContactValue7"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey8"></th><td><input id="editUserProfileExtraContactValue8"></td></tr>
				<tr><th><input id="editUserProfileExtraContactKey9"></th><td><input id="editUserProfileExtraContactValue9"></td></tr>
			</table>
		</p>
		<hr>
		<button onclick="editUserProfileUpdate()">Update</button>
		<button onclick="editUserProfileDeleteProfile()">Delete profile</button>
	</div>
</widget-window>

<!-- context menus -->
<widget-contextmenu id="item-contextmenu" style="display: none;">
  <ul slot="menu" id="item-contextmenu-menu">
    <li id="viewUserProfileLi" onclick="requestViewUserProfile(contextMenuItem)">View user profile</li>
    <li onclick="editItem(contextMenuItem)">Edit</li>
    <li id="droptakeitem" onclick="dropTakeItem(contextMenuItem)">Drop</li>
    <li onclick="moveItem(contextMenuItem)">Move to...</li>
    <li onclick="cloneItem(contextMenuItem)">Clone</li>
    <li onclick="cloneItem(contextMenuItem, true)">Clone (Temporary)</li>
    <li id="copyItemToHotbarLi" onclick="copyItemToHotbar(contextMenuItem)">Copy to hotbar</li>
    <li onclick="sendPrivateMessageToItem(contextMenuItem)">Private message</li>
    <li onclick="deleteItem(contextMenuItem)">Delete</li>
    <!-- <li onclick="referenceItem(contextMenuItem)">Create Reference</li> -->
  </ul>
</widget-contextmenu>

<widget-contextmenu id="mapobj-contextmenu" style="display: none;">
  <ul slot="menu" id="mapobj-contextmenu-menu">
    <li onclick="editMapObj()">Edit</li>
    <li id="mapobj_movetop" onclick="moveTopMapObj()">Move to top</li>
    <li id="mapobj_moveup" onclick="moveUpMapObj()">Move up</li>
    <li id="mapobj_movedown" onclick="moveDownMapObj()">Move down</li>
    <li id="mapobj_movebottom" onclick="moveBottomMapObj()">Move to bottom</li>
    <li onclick="copyMapObjToHotbar()">Copy to hotbar</li>
    <li onclick="deleteMapObj()">Delete</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="turf-contextmenu" style="display: none;">
  <ul slot="menu" id="turf-contextmenu-menu">
    <li onclick="editTurf()">Edit</li>
    <li onclick="copyTurfToHotbar()">Copy to hotbar</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="build-contextmenu" style="display: none;">
  <ul slot="menu" id="build-contextmenu-menu">
    <li onclick="copyBuildToHotbar();">Copy to hotbar</li>
    <li onclick="copyBuildToInventory();">Copy to inventory</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="hotbar-contextmenu" style="display: none; z-index: 10;">
  <ul slot="menu" id="hotbar-contextmenu-menu">
    <li onclick="copyHotbarSlotToInventory();">Copy to inventory</li>
    <li onclick="copyHereHotbarSlot();">Copy here</li>
    <li onclick="editHotbarSlot();">Edit</li>
    <li onclick="deleteHotbarSlot();">Delete</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="hotbar-no-item-contextmenu" style="display: none; z-index: 10;">
  <ul slot="menu" id="hotbar-no-item-contextmenu-menu">
    <li onclick="copyHereHotbarSlot();">Copy here</li>
    <li onclick="newTileHotbarSlot();">New tile</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="fileupload-contextmenu-image" style="display: none;">
  <ul slot="menu" id="fileupload-contextmenu-menu">
	<li onclick="fileUploadContextMenuEdit();">Edit image</li>
	<li onclick="moveFileOrFolder(contextMenuFile, false);">Move image</li>
	<li><a id="openFileInNewTabLink" href="https://example.com" target="_blank">Open image in new tab</a></li>
	<li onclick="fileUploadContextMenuTileSheet();">Create a tile sheet item</li>
	<li onclick="fileUploadContextMenuAppearance();">Set appearance to this</li>
	<li onclick="fileUploadContextMenuDelete();">Delete image</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="fileupload-contextmenu-music" style="display: none;">
  <ul slot="menu" id="fileupload-contextmenu-menu">
	<li onclick="fileUploadPlayMusic();">Play music</li>
	<li onclick="fileUploadContextMenuEdit();">Edit music</li>
	<li onclick="moveFileOrFolder(contextMenuFile, false);">Move music</li>
	<li><a id="openMusicInNewTabLink" href="https://example.com" target="_blank">Open music in new tab</a></li>
	<li onclick="fileUploadSetMapMusic();">Set map music to this</li>
	<li onclick="fileUploadContextMenuDelete();">Delete music</li>
  </ul>
</widget-contextmenu>

<widget-contextmenu id="filefolder-contextmenu" style="display: none;">
  <ul slot="menu" id="filefolder-contextmenu-menu">
	<li onclick="fileFolderContextMenuEdit();">Edit folder</li>
	<li onclick="moveFileOrFolder(contextMenuFolder, true);">Move folder</li>
	<li onclick="fileFolderContextMenuDelete();">Delete folder</li>
  </ul>
</widget-contextmenu>

<!-- Game interface with the map and chat -->

<!-- Map and hotbar -->
<div id="map-container">
  <canvas class="unselectable" id="map"></canvas>

  <div id="selector-container">
    <canvas class="unselectable" id="selector" width="320" height="16" imageSmoothingEnabled="false"></canvas>
  </div>
</div>

<!-- Chat -->
<div id="chat-container">
  <div id="chatArea" class="chatarea">
  </div>
  <div>
    <textarea type="text" rows="1" style="resize: vertical; min-height: 2em; width:100%;" id="chatInput" autocomplete="off" placeholder="chat here... (click or press enter to start!)"></textarea><br>
  </div>
</div>

<!-- Main wrapper div -->
</div>
</body>
</html>
